SQL注入：
===

## 原理：
发生在应用程序与数据库层的安全漏洞。<br>

* 用户访问网页实际流程：
	* 输入url,经 DNS 解析为 IP，连接到目标服务器
	* 服务器从本地储存的 Web 程序中加载页面并解析
	* 页面连接位于数据访问层的 DBMS, 并执行 SQL 	--sql注入的发生环节
	* DBMS 执行 sql 后将结果返回给 Web Server
	* 业务逻辑层的 Web Server 将页面封装成 HTML 格式，并响应给浏览器
	* 浏览器解析 HTML 页面并展示给用户

## 危害：
* 猜解后台数据库，盗取网站敏感信息
* 绕过验证，登录网站后台
* 借助数据库的存储过程进行提权等操作

## 分类：
### 从协议角度分类：
* GET注入：<br>
通过在url中的自定义明文参数值来拼接sql，以获取所需信息。<br>
* POST注入：<br>
通过 Burp Suite 抓包的方式，抓取请求数据包，修改其中sql提取的属性的值，达到拼接sql的目的。<br>

### 从漏洞的利用类型类型分类：
* 布尔型注入：
	* 可拼接一个bool类型的判断
```
	示例： 
	http://... ?id=1 and substring(version(),1,1)=5
	如果服务端MySQL版本是5.x的话，那么页面的响应就和正常请求一样；
	如果不是5.x的话，就没有回显。
```
* 可联合查询注入：
	* 可拼接 union 子句
```
	示例：
	http://... ?id=1 union all select schema_name from information_schema.schemata
	通过union查询获取到想要的数据，前提是请求返回后能输出sql执行后查询到的内容。
```
* 基于时间延迟注入：
	* 时间盲注
```
	示例：
	http://... ?id=1 and sleep(3)

	可通过休眠等待时间来判断请求响应的时间。如网页响应时间相应变慢，则表示注入成功。

	适用场景： 页面不会返回错误信息时。
```
* 报错型注入：
	* 利用查询语句，获取数据库中额外的报错信息
```
	示例：
	利用 group by 的 duplicate entry 错误 来获取额外的报错信息。
	适用场景： 页面能够输出sql 报错信息，但不全面时。
```
* 可多语言查询注入：
	* 可拼接一个自定义的独立sql语句
```
	示例：
	http://... ?id=1;update t set name='a ' where id=1
	能够执行多条语句，非常危险。
```


## 1、初阶：

### 判断SQL注入点：
#### 难点：
* 如何发现Web应用存在sql注入漏洞
* 如何构建能够被成功执行的第一条语句

#### 关键点：
* 判断该访问目标URL是否存在sql注入？
	* 单引号判断法： <br>
		http://...?id=1'	若页面返回错误，则存在sql注入。<br>
		原因： 无论字符串还是整型，都会因为单引号个数不匹配而报错。<br>
	* 回归测试：<br>
		核心：推测后端sql语句的形态，尝试闭合sql语句。<br>
* 如果存在sql注入，属于哪种sql注入？
	* 数字型：<br>
		通常构造 and 1=1 或者 and 1=2 来判断<br>
	* 字符型：<br>
		通常构造 ' and '1'='1 或者 ' and '1' = '2 来判断<br>
``TIPS: 只要是带有参数的 动态网页 且此网页访问了数据库，那么就有可能存在sql注入。``

### 防御方式：
* 减少错误信息反馈
* 对输入的特殊符号进行转义（黑名单）<br>
	\x00 \n \r \ ' " \x1a  --若经自定义转椅函数处理成功，则使用转义后字符；若失败，则返回false<br>
* 对输入特殊词组进行过滤（黑名单）<br>
	常见的关键字： and or select union 空格... 进行过滤<br>


## 2、中阶：

### 时间盲注：基于时间延迟的注入
* 常用函数：
	* substr(a, b, c): 截取字符串 a 的 [b, c) 区间的字符
	* count(): 
	* ascii():
	* length():
	* left(a, b): 截取字符串 a 的前 b 个字符
	* sleep(n): 
* 拼接sql时将 sleep() 放在最后一个条件，当页面响应时间明显变长时，说明sleep（）执行成功。<br>	  由此可见：之前的判断语句都为true，以此可以通过自定义之前的判断来获取相应信息。<br>

### HTTP头注入：
针对请求头，如果不加以过滤或转义，在直接与数据库交互的构成中容易被利用进行sql注入攻击。<br>
#### 常见场景：
* 访问Web Server时，Web Server 会从 HTTP Header 中取出浏览器信息、IP地址、HOST信息等储存到数据库中。

### 报错注入：
#### 原理：
* 用于使sql语句报错的语法，返回的错误信息即是攻击者需要的信息。

#### 适用场景：
* 结果无回显但输出错误信息的情况。

#### 错误类型：
* BigInt 等数据类型溢出
* Xpath 语法错误
* count() + rand() + group_by() 导致重复
* 空间数据类型函数错误

### 堆叠注入：
#### 原理：
* 拼接多条sql语句，使多条语句顺序执行。

#### 适用场景：
* 篡改用户密码，待攻击者使用 账户及篡改的密码 登入系统后，再将密码改回。而已登入系统不退出。

#### 局限性：
* 回显通常为单一结果，因此只能看到第一条sql语句的执行结果；
* 使用堆叠注入前，我们需要预先知道一些数据库相关信息。 如：表名、列名...